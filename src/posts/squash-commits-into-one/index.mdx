---
title: å°‡å¤šå€‹ Commit åˆä½µæˆä¸€å€‹ (Squash Commits)
date: 2024-05-22T00:00:00.000Z
description: ä½¿ç”¨ git rebase -i å°‡å¤šå€‹ Commit åˆä½µæˆä¸€å€‹ï¼Œè®“å°ˆæ¡ˆå…·æœ‰æ•´æ½”çš„æäº¤æ­·å²è¨˜éŒ„ã€‚
categories:
  - Git
tags:
  - Git
wordCount: 823
---

æœ€è¿‘åœ¨å·¥ä½œä¸Šé‡åˆ°éœ€è¦ Squash Commits çš„æƒ…æ³ï¼Œå®Œå…¨ä¸æ‡‚ã€ŒSquash Commitsã€æ˜¯ä»€éº¼çš„æˆ‘ï¼Œç˜‹ç‹‚æŸ¥äº†ä¸€å †æ–‡ç« ã€‚é›–ç„¶é€™äº›æ–‡ç« å·²ç¶“å¯«å¾—å¾ˆç°¡å–®æ˜“æ‡‚ï¼Œä¹Ÿéƒ½æœ‰æ­é…åœ–ç‰‡èªªæ˜ï¼Œä½†å»ç¸½æ˜¯ç¼ºäº†ä¸€é»å°ç´°ç¯€ï¼Œè®“æˆ‘åœ¨æ“ä½œæ™‚ä»èˆŠé‡åˆ°å›°é›£ã€‚å› æ­¤ï¼Œæˆ‘æ‰“ç®—ç°¡å–®æ•´ç†ä¸€ç¯‡æ–‡ç« ï¼Œè¨˜éŒ„è‡ªå·±çš„æ“ä½œæ­¥é©Ÿï¼Œä¹Ÿå¹«åŠ©å…¶ä»–äººå¿«é€Ÿåˆä½µå¤šå€‹ Commitã€‚

ä»¥ä¸‹æ“ä½œæ­¥é©Ÿæ˜¯åœ¨ VS Code Terminal ä¸­é€²è¡Œï¼š

## 1. æŸ¥çœ‹æäº¤æ­·å²

```shell
$ git log --oneline
9d13562 (HEAD -> test, origin/test) feat: add cat 3
c2336f7 feat: add cat 2
e15527e feat: add cat 1
263e56c Remove unused HTML comments
```

å‡è¨­æˆ‘å€‘éœ€è¦å°‡ `feat: add cat 2 (c2336f7)` è·Ÿ `feat: add cat 3 (9d13562)`åˆä½µé€² `feat: add cat 1 (e15527e)`ã€‚

ğŸ“Œ è¦é›¢é–‹ log åªè¦æŒ‰ä¸€ä¸‹éµç›¤ä¸Šçš„ q å³å¯

## 2. é–‹å§‹åˆä½µ

```shell
$ git rebase -i HEAD~3
# æˆ–æ˜¯
$ git rebase -i e15527e^
```

é€™è£¡çš„ `HEAD~3` ä»£è¡¨è¦åˆä½µå¾æœ€è¿‘çš„ Commit (HEAD) é–‹å§‹ç®—èµ·çš„å‰ä¸‰å€‹ Commitsï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Commit ID ç›´æ¥æŒ‡å®šè¦åˆä½µé€²çš„ Commitã€‚

é€å‡ºå¾Œå°±æœƒé€²å…¥ç·¨è¼¯æ¨¡å¼ï¼Œå…§å®¹å¦‚ä¸‹ï¼š

```shell
pick e15527e feat: add cat 1
pick c2336f7 feat: add cat 2
pick 9d13562 feat: add cat 3

# é‡å®šåŸºåº• 263e56c..9d13562 åˆ° 263e56cï¼ˆ3 å€‹æäº¤ï¼‰
#
# å‘½ä»¤ï¼š
# ä»¥ä¸‹ç•¥é
```

ğŸ“Œ å¦‚æœé€²åˆ°ç·¨è¼¯æ¨¡å¼å¾Œç™¼ç¾ rebase éŒ¯äº†ï¼Œå¯ä»¥æŒ‰ä¸‹ ESC éµï¼Œå†è¼¸å…¥ :qa! é€å‡ºï¼Œé›¢é–‹ä¸¦å–æ¶ˆæœ¬æ¬¡ rebaseã€‚

ç”±æ–¼æˆ‘å€‘æ˜¯è¦æŠŠ `feat: add cat 2` è·Ÿ `feat: add cat 3` åˆä½µé€² `feat: add cat 1`ï¼Œæ‰€ä»¥æŠŠéœ€è¦åˆä½µçš„ Commits å‰é¢çš„ `pick` æ”¹æˆ `squash` æˆ– `s`ã€‚

```shell
pick e15527e feat: add cat 1
s c2336f7 feat: add cat 2
s 9d13562 feat: add cat 3
```

ğŸ“Œ æŒ‰ä¸€ä¸‹éµç›¤ä¸Šçš„ a å¯ä»¥é€²å…¥ç·¨è¼¯æ¨¡å¼ (æœƒçœ‹åˆ°å‡ºç¾ -- INSERT --)

ç·¨è¼¯å®Œå¾Œï¼ŒæŒ‰ä¸‹ `ESC` éµï¼Œå†è¼¸å…¥ `:wq` é€å‡ºã€‚

## 3. ç·¨è¼¯ Commit è¨Šæ¯

æ¥è‘—æœƒå†é€²å…¥ç·¨è¼¯æ¨¡å¼ï¼Œå…§å®¹å¦‚ä¸‹ï¼š

```shell
# é€™æ˜¯æ•´åˆ 3 å€‹æäº¤çš„é›†åˆæäº¤ã€‚
# é€™æ˜¯ç¬¬ä¸€å€‹æäº¤èªªæ˜ï¼š

feat: add cat 1

# é€™æ˜¯æäº¤èªªæ˜ #2ï¼š

feat: add cat 2

# é€™æ˜¯æäº¤èªªæ˜ #3ï¼š

feat: add cat 3

# ä»¥ä¸‹ç•¥é
```

é€™æ˜¯åˆä½µå¾Œçš„ Commit è¨Šæ¯ï¼Œå¯ä»¥å°‡é€™ä¸‰å€‹ Commits çš„è¨Šæ¯æ•´åˆæˆä¸€å€‹ï¼Œä½†å€‹äººè¦ºå¾—åœ¨é€™è£¡ç·¨è¼¯ Commit è¨Šæ¯å¾ˆå¸¸å¤±æ•—ï¼Œæ‰€ä»¥æˆ‘ç¢ºèªè¦åˆä½µçš„æäº¤æ²’å•é¡Œå¾Œï¼Œå°±æœƒæŒ‰ä¸‹ `ESC` éµï¼Œè¼¸å…¥ `:wq` é€å‡ºã€‚

## 4. ä¿®æ”¹ Commit è¨Šæ¯

```shell
$ git log --oneline
18aa49b (HEAD) feat: add cat 1
263e56c Remove unused HTML comments
```

å†æ¬¡æŸ¥çœ‹æäº¤æ­·å²ï¼Œå¯ä»¥çœ‹åˆ° `feat: add cat 2` è·Ÿ `feat: add cat 3` å·²ç¶“è¢«åˆä½µé€² `feat: add cat 1 (18aa49b)`ï¼Œå¤šé¤˜çš„ Commits ä¹Ÿå·²ç¶“è¢«ç§»é™¤ã€‚

é€™æ˜¯æˆ‘å€‘ä¿®æ”¹ä¸€ä¸‹è¨Šæ¯ï¼Œä½¿å…¶æ›´åŠ å®Œæ•´ï¼š

```shell
$ git commit --amend -m "feat: add all cats"
```

## 5. å¼·åˆ¶æ¨é€

```shell
$ git push --force origin <åˆ†æ”¯åç¨±>
```

å¦‚æœä½ è¦æ¨é€çš„åˆ†æ”¯çˆ² protected å‰‡ç„¡æ³•å¼·åˆ¶æ¨é€ (ä¹Ÿä¸å»ºè­°)

å…¶å¯¦æˆ‘é‚„ä¸çŸ¥é“ç‚ºä»€éº¼ä¸èƒ½ä¸€èˆ¬æ¨é€ï¼Œå®ƒæœƒéœ€è¦ merge æˆ‘è¦ºå¾—å¾ˆé†œï¼Œæ‰€ä»¥æˆ‘ç›®å‰æ˜¯å¼·åˆ¶æ¨é€ã€‚
å¦‚æœæœ‰äººçŸ¥é“æ›´å¥½çš„æ–¹å¼ï¼Œè«‹å‘Šè¨´æˆ‘ ( Â´â€¢Ì¥Ï‰â€¢Ì¥` )
